<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SMB AI Audit</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="max-w-3xl mx-auto p-6">
    <h1 class="text-4xl font-bold mb-8 text-center">SMB AI Audit Quiz</h1>

    <!-- ============================= -->
    <!-- 1) The Quiz Form -->
    <!-- ============================= -->
    <form id="quizForm" class="space-y-8 bg-white p-8 rounded-lg shadow-lg">
      <!-- 1. Business Type & Industry -->
      <div>
        <label for="businessType" class="block text-lg font-medium text-gray-800 mb-2">
          1. Business Type &amp; Industry
        </label>
        <input
          type="text"
          id="businessType"
          name="businessType"
          placeholder="e.g. Retail bakery, Health clinic, Software agency"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          required
        />
      </div>

      <!-- 2. Company Size & Scale -->
      <div>
        <label for="scale" class="block text-lg font-medium text-gray-800 mb-2">
          2. Company Size &amp; Scale
        </label>
        <input
          type="text"
          id="scale"
          name="scale"
          placeholder="e.g. 10 employees / $1M annual revenue"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          required
        />
      </div>

      <!-- 3. Current Tools & Systems -->
      <div>
        <label for="q1" class="block text-lg font-medium text-gray-800 mb-2">
          3. Current Tools &amp; Systems
        </label>
        <textarea
          id="q1"
          name="q1"
          placeholder="List any software (CRM, ERP, spreadsheets) or manual processes you rely on today."
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 4. Data & Reporting -->
      <div>
        <label for="q2" class="block text-lg font-medium text-gray-800 mb-2">
          4. Data &amp; Reporting
        </label>
        <textarea
          id="q2"
          name="q2"
          placeholder="How do you collect, store, and analyze data (sales, customers, inventory)? Are regular reports easy to generate?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 5. Customer Acquisition & Marketing -->
      <div>
        <label for="q3" class="block text-lg font-medium text-gray-800 mb-2">
          5. Customer Acquisition &amp; Marketing
        </label>
        <textarea
          id="q3"
          name="q3"
          placeholder="Which channels (cold calling, social media, email campaigns, referrals) do you use to find customers? What works best/worst?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 6. Customer Support & Retention -->
      <div>
        <label for="q4" class="block text-lg font-medium text-gray-800 mb-2">
          6. Customer Support &amp; Retention
        </label>
        <textarea
          id="q4"
          name="q4"
          placeholder="How do you handle inquiries, support tickets, or follow-up? Are there recurring delays or quality issues?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 7. Operational Bottlenecks -->
      <div>
        <label for="q5" class="block text-lg font-medium text-gray-800 mb-2">
          7. Operational Bottlenecks
        </label>
        <textarea
          id="q5"
          name="q5"
          placeholder="Where do you lose the most time or see repeated errors (e.g., inventory, scheduling, invoicing)?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 8. Team & Skillset -->
      <div>
        <label for="q6" class="block text-lg font-medium text-gray-800 mb-2">
          8. Team &amp; Skillset
        </label>
        <textarea
          id="q6"
          name="q6"
          placeholder="Which roles/functions are most stretched or understaffed? Where do you struggle to find or train the right skills?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 9. Primary Business Goals -->
      <div>
        <label for="q7" class="block text-lg font-medium text-gray-800 mb-2">
          9. Primary Business Goals
        </label>
        <textarea
          id="q7"
          name="q7"
          placeholder="What is your top priority this year—revenue growth, cost reduction, customer satisfaction, product expansion, etc.?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 10. Technology & AI Familiarity -->
      <div>
        <label for="q8" class="block text-lg font-medium text-gray-800 mb-2">
          10. Technology &amp; AI Familiarity
        </label>
        <textarea
          id="q8"
          name="q8"
          placeholder="Have you tried any AI-powered tools (chatbots, predictive analytics, automation)? Which, and how did they perform?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 11. Budget & Investment Appetite -->
      <div>
        <label for="q9" class="block text-lg font-medium text-gray-800 mb-2">
          11. Budget &amp; Investment Appetite
        </label>
        <textarea
          id="q9"
          name="q9"
          placeholder="Roughly how much time, money, or resources can you allocate to new software or AI initiatives in the next 6 months?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 12. Risk & Compliance Concerns -->
      <div>
        <label for="q10" class="block text-lg font-medium text-gray-800 mb-2">
          12. Risk &amp; Compliance Concerns
        </label>
        <textarea
          id="q10"
          name="q10"
          placeholder="Are there any data-privacy, regulatory, or security requirements we should consider when adding new technology?"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          rows="3"
          required
        ></textarea>
      </div>

      <!-- 13. Email (for copy & mailing list) -->
      <div>
        <label for="email" class="block text-lg font-medium text-gray-800 mb-2">
          13. Email Me a Copy &amp; Join Our Mailing List
        </label>
        <input
          type="email"
          id="email"
          name="email"
          placeholder="you@example.com"
          class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-3 px-4 text-lg"
          required
        />
      </div>

      <!-- Submit Button -->
      <div>
        <button
          type="submit"
          id="freeBtn"
          class="w-full bg-indigo-600 text-white py-3 rounded-md text-lg font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
        >
          Get Free AI Audit
        </button>
      </div>
    </form>

    <!-- ============================= -->
    <!-- 2) Free Audit Display -->
    <!-- ============================= -->
    <div id="report" class="mt-8 bg-white p-8 rounded-lg shadow-lg hidden">
      <h2 class="text-3xl font-semibold mb-4">Your Free AI Audit</h2>
      <div id="reportContent" class="whitespace-pre-wrap text-gray-800 text-lg mb-6"></div>
      <!-- “Get Advanced” button will be injected here -->
    </div>
  </div>

  <script>
    const form = document.getElementById('quizForm');
    const reportDiv = document.getElementById('report');
    const reportContent = document.getElementById('reportContent');
    const freeBtn = document.getElementById('freeBtn');

    form.addEventListener('submit', async function(e) {
      e.preventDefault();

      // 1) Collect form values into a JSON object
      const email   = form.email.value.trim();
      const answers = {
        businessType: form.businessType.value.trim(),
        scale:         form.scale.value.trim(),
        q1:            form.q1.value.trim(),
        q2:            form.q2.value.trim(),
        q3:            form.q3.value.trim(),
        q4:            form.q4.value.trim(),
        q5:            form.q5.value.trim(),
        q6:            form.q6.value.trim(),
        q7:            form.q7.value.trim(),
        q8:            form.q8.value.trim(),
        q9:            form.q9.value.trim(),
        q10:           form.q10.value.trim()
      };

      // 2) Reset UI to “loading”
      reportDiv.classList.add('hidden');
      reportContent.textContent = 'Generating your free AI audit…';
      reportContent.classList.remove('text-red-600');
      freeBtn.disabled = true;
      freeBtn.classList.add('opacity-50');

      try {
        // 3) Call free‐audit endpoint
        const resp = await fetch('https://api.aiauditpro.com/api/audit.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, answers })
        });
        const json = await resp.json();

        if (json.error) {
          throw new Error(json.error.message || JSON.stringify(json.error));
        }

        // 4) Extract the raw free audit text
        let raw = json.choices[0].message.content || 'No audit returned.';

        // 5) Strip out Markdown bold (i.e. **text** → text)
        raw = raw.replace(/\*\*(.*?)\*\*/g, '$1');

        // 6) Show the free audit in the <div>, preserving line breaks
        reportContent.textContent = raw;
        reportDiv.classList.remove('hidden');

        // 7) Append “Get Advanced AI Audit ($49)” button below
        //    Only create once—remove any existing
        const existingBtn = document.getElementById('advBtn');
        if (existingBtn) existingBtn.remove();

        const advBtn = document.createElement('button');
        advBtn.id = 'advBtn';
        advBtn.textContent = 'Get Advanced AI Audit ($49)';
        advBtn.className = 'w-full bg-green-600 text-white py-3 rounded-md text-lg font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2';
        advBtn.addEventListener('click', getAdvanced);
        reportDiv.appendChild(advBtn);

      } catch (err) {
        reportContent.textContent = `Error: ${err.message}`;
        reportContent.classList.add('text-red-600');
        reportDiv.classList.remove('hidden');
      } finally {
        // 8) Re‐enable free button
        freeBtn.disabled = false;
        freeBtn.classList.remove('opacity-50');
      }
    });

    async function getAdvanced(e) {
      e.preventDefault();
      freeBtn.disabled = true;
      const email   = form.email.value.trim();
      const answers = {
        businessType: form.businessType.value.trim(),
        scale:         form.scale.value.trim(),
        q1:            form.q1.value.trim(),
        q2:            form.q2.value.trim(),
        q3:            form.q3.value.trim(),
        q4:            form.q4.value.trim(),
        q5:            form.q5.value.trim(),
        q6:            form.q6.value.trim(),
        q7:            form.q7.value.trim(),
        q8:            form.q8.value.trim(),
        q9:            form.q9.value.trim(),
        q10:           form.q10.value.trim()
      };

      try {
        // 9) Call your “create-checkout-session” endpoint
        const resp = await fetch('https://api.aiauditpro.com/api/create-checkout-session.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, answers })
        });
        const { url } = await resp.json();
        window.location = url; // Redirect to Stripe Checkout
      } catch (err) {
        alert('Error initiating payment: ' + err.message);
        freeBtn.disabled = false;
      }
    }
  </script>
</body>
</html>
